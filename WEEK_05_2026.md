# AgentUI: Canvas & Plan View
**Week of Jan 26, 2026**

---

## Goal

Build two separate features:
1. **Canvas** â€” Document viewer with export
2. **Plan View** â€” Task list for agent planning mode

**Reference:**
- [Gemini Canvas](https://gemini.google.com) â€” best for docs
- [Claude Artifacts](https://www.reidbarber.com/blog/reverse-engineering-claude-artifacts)
- [ChatGPT Canvas](https://simonwillison.net/2025/jan/25/openai-canvas-gets-a-huge-upgrade/)
- [Cycls Protocol](https://github.com/Cycls/cycls/blob/main/docs/streaming-protocol.md)

---

# PART 1: CANVAS

---

## 1.1 Overview

Canvas displays documents in a side panel. One canvas at a time â€” new canvas replaces current.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CHAT                                â”‚  CANVAS                         â”‚
â”‚                                      â”‚                                 â”‚
â”‚  Here's a draft for you...           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                                      â”‚  â”‚ ğŸ“„ Travel Guide   â†“   âœ•  â”‚  â”‚
â”‚                                      â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚                                      â”‚  â”‚ # Travel Guide            â”‚  â”‚
â”‚                                      â”‚  â”‚ ## Introduction           â”‚  â”‚
â”‚                                      â”‚  â”‚ Welcome to...             â”‚  â”‚
â”‚                                      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1.2 Canvas States

```
CLOSED  â”€â”€open:trueâ”€â”€â–¶  STREAMING  â”€â”€done:trueâ”€â”€â–¶  COMPLETE  â”€â”€open:false / âœ•â”€â”€â–¶  CLOSED
```

| State | Export Button | User Can Close |
|-------|---------------|----------------|
| Closed | â€” | â€” |
| Streaming | Disabled | Yes |
| Complete | Enabled | Yes |

---

## 1.3 Protocol

### Event Structure

```
{"type": "canvas", "canvas": "document", ...fields}
```

### Fields

| Field | Type | Description |
|-------|------|-------------|
| `open` | boolean | `true` opens canvas, `false` closes canvas |
| `title` | string | Document title (with `open: true`) |
| `content` | string | Text to append |
| `done` | boolean | `true` marks complete, enables export |

### Event Sequence

```python
# Backend (Python)

# 1. Open canvas
yield {"type": "canvas", "canvas": "document", "open": True, "title": "Travel Guide"}

# 2. Stream content
yield {"type": "canvas", "canvas": "document", "content": "# Travel Guide\n\n"}
yield {"type": "canvas", "canvas": "document", "content": "## Introduction\n"}
yield {"type": "canvas", "canvas": "document", "content": "Welcome to..."}

# 3. Mark complete
yield {"type": "canvas", "canvas": "document", "done": True}

# 4. Close (optional â€” user can also close via âœ•)
yield {"type": "canvas", "open": False}
```

### RTL Support

Auto-detected from content. No field needed.

FE checks first non-whitespace characters for Arabic/Hebrew Unicode ranges and applies `dir="rtl"` to content container.

---

## 1.4 Export (Required)

Enabled only after `done: true`.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“„ Travel Guide              [â†“]   âœ•  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  # Travel Guide    â”‚ ğŸ“‹ Copy        â”‚ â”‚
â”‚                    â”‚ ğŸ“„ Markdown    â”‚ â”‚
â”‚  ## Introduction   â”‚ ğŸ“ Plain Text  â”‚ â”‚
â”‚                    â”‚ ğŸ“‘ PDF         â”‚ â”‚
â”‚                    â”‚ ğŸ“ƒ Word        â”‚ â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1.5 Components

```
Canvas/
â”œâ”€â”€ CanvasPanel.tsx        # Split layout, open/close
â”œâ”€â”€ CanvasHeader.tsx       # Title, export, close
â”œâ”€â”€ DocumentCanvas.tsx     # Markdown, streaming cursor
â”œâ”€â”€ ExportMenu.tsx         # Copy, .md, .txt, .pdf, .docx
â””â”€â”€ useCanvas.ts           # State + SSE handling
```

---

---

# PART 2: PLAN VIEW

---

## 2.1 Overview

Plan view shows agent tasks. Append items, update status by index.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ Implementation Plan                                   âœ•  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â˜‘ Research existing auth flow                              â”‚
â”‚  â˜‘ Design new token system                                  â”‚
â”‚  â—‰ Implement refresh logic                                  â”‚
â”‚  â—‹ Add error handling                                       â”‚
â”‚  â—‹ Write tests                                              â”‚
â”‚                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚
â”‚  2 of 5 complete                                            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2.2 Status Icons

```
â—‹  pending
â—‰  in_progress
â˜‘  completed
```

---

## 2.3 Protocol

### Event Structure

```
{"type": "plan", ...fields}
```

### Fields

| Field | Type | Description |
|-------|------|-------------|
| `title` | string | Plan title (opens the view) |
| `item` | string | Add new task |
| `status` | string | `"pending"` \| `"in_progress"` \| `"completed"` |
| `index` | number | Update task at index (0-based) |
| `done` | boolean | `true` marks plan complete |

### Event Sequence

```python
# Backend (Python)

# 1. Open plan
yield {"type": "plan", "title": "Implementation Plan"}

# 2. Add items
yield {"type": "plan", "item": "Research existing auth flow", "status": "completed"}
yield {"type": "plan", "item": "Design new token system", "status": "completed"}
yield {"type": "plan", "item": "Implement refresh logic", "status": "in_progress"}
yield {"type": "plan", "item": "Add error handling"}
yield {"type": "plan", "item": "Write tests"}

# 3. Update status (as agent works)
yield {"type": "plan", "index": 2, "status": "completed"}
yield {"type": "plan", "index": 3, "status": "in_progress"}

# 4. Complete
yield {"type": "plan", "done": True}
```

---

---

# PART 3: THIS WEEK

---

## Canvas
- [ ] CanvasPanel â€” split layout, open/close
- [ ] DocumentCanvas â€” markdown, streaming cursor
- [ ] ExportMenu â€” copy, .md, .txt, .pdf, .docx
- [ ] RTL auto-detect
- [ ] SSE handler for canvas events

## Plan
- [ ] PlanPanel â€” container
- [ ] PlanItem â€” â—‹/â—‰/â˜‘ icons
- [ ] PlanProgress â€” completion count
- [ ] SSE handler for plan events

---

*Last updated: Jan 22, 2026*
